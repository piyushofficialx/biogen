<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accurex Builder V1.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.min.js"></script>
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    animation: { 'fade-in': 'fadeIn 0.4s ease-out' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        /* Custom Scrollbar (Main Window) */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
        ::-webkit-scrollbar-thumb:hover { background-color: #94a3b8; }
        .dark ::-webkit-scrollbar-thumb { background-color: #475569; }
        .dark ::-webkit-scrollbar-thumb:hover { background-color: #64748b; }

        /* Preview Scrollbar */
        .preview-scroll::-webkit-scrollbar { width: 4px; }
        .preview-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 4px; }
        .dark .preview-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        /* Sortable Ghost */
        .ghost-class { opacity: 0.4; background: #eff6ff; border: 2px dashed #3b82f6; }

        /* Input Reset */
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 40px; height: 40px; border-radius: 10px; overflow: hidden; cursor: pointer; padding: 0;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; }
    </style>
</head>
<body class="bg-[#f1f5f9] dark:bg-[#020617] text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <nav class="fixed top-0 w-full z-50 border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-[#020617]/80 backdrop-blur-md transition-colors duration-300">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-black dark:bg-white text-white dark:text-black rounded-lg flex items-center justify-center font-bold shadow-lg">A</div>
                <div class="flex flex-col">
                    <span class="font-bold text-lg leading-none tracking-tight">Accurex</span>
                    <span class="text-[10px] text-gray-500 font-semibold uppercase tracking-widest">Studio</span>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <button id="theme-toggle" class="p-2.5 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all text-gray-600 dark:text-gray-300">
                    <i data-lucide="moon" class="w-5 h-5"></i>
                </button>
                <button id="export-btn" class="hidden md:flex bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold items-center gap-2 hover:shadow-lg hover:shadow-blue-500/25 transition-all active:scale-95">
                    <i data-lucide="download" class="w-4 h-4"></i> Export Site
                </button>
            </div>
        </div>
    </nav>

    <main class="pt-28 pb-20 min-h-screen">
        <div class="container mx-auto px-4 md:px-6">
            
            <div class="flex justify-center mb-10">
                <div class="animate-fade-in inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 shadow-sm text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider">
                    <span class="relative flex h-2.5 w-2.5">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                    </span>
                    V 1.0 Builder
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">

                <div class="lg:col-span-7 space-y-6">

                    <div class="glass-panel p-6 rounded-3xl animate-fade-in">
                        <h2 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-5 flex items-center gap-2">
                            <i data-lucide="award" class="w-4 h-4"></i> Branding / Logo
                        </h2>
                        <div class="flex items-center gap-4">
                            <div class="relative group w-full max-w-[120px]">
                                <label for="logo-upload" class="cursor-pointer">
                                    <div id="logo-preview-box" class="h-20 w-full rounded-xl bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-600 flex flex-col items-center justify-center hover:border-blue-500 transition-colors">
                                        <i data-lucide="upload" class="w-5 h-5 text-gray-400 mb-1"></i>
                                        <span class="text-[10px] text-gray-400 font-medium">Add Logo</span>
                                        <img id="logo-img-preview" src="" class="absolute inset-0 w-full h-full object-contain p-2 hidden">
                                    </div>
                                </label>
                                <input type="file" id="logo-upload" accept="image/*" class="hidden">
                                <button id="remove-logo-btn" class="hidden text-xs text-red-500 mt-1 w-full text-center hover:underline">Remove</button>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-500 mb-2">Upload a PNG/SVG logo to appear at the top. Leave empty to hide.</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel p-6 rounded-3xl animate-fade-in" style="animation-delay: 0.1s;">
                        <h2 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-5 flex items-center gap-2">
                            <i data-lucide="user-circle" class="w-4 h-4"></i> Profile
                        </h2>
                        
                        <div class="flex items-start gap-5">
                            <div class="relative group shrink-0">
                                <label for="profile-upload" class="cursor-pointer block">
                                    <div id="profile-preview-box" class="w-24 h-24 rounded-full bg-gray-100 dark:bg-gray-800 overflow-hidden border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center hover:border-blue-500 transition-colors shadow-sm">
                                        <i data-lucide="camera" class="w-6 h-6 text-gray-400"></i>
                                        <img id="profile-img-preview" src="" class="absolute inset-0 w-full h-full object-cover hidden">
                                    </div>
                                </label>
                                <input type="file" id="profile-upload" accept="image/*" class="hidden">
                            </div>
                            
                            <div class="flex-1 space-y-3">
                                <input type="text" id="name-input" placeholder="Display Name" class="w-full p-3.5 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all font-semibold">
                                <textarea id="bio-input" rows="2" placeholder="Write a short bio..." class="w-full p-3.5 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all resize-none text-sm"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel p-6 rounded-3xl animate-fade-in" style="animation-delay: 0.2s;">
                        <div class="flex justify-between items-center mb-5">
                            <h2 class="text-xs font-bold uppercase tracking-wider text-gray-500 flex items-center gap-2">
                                <i data-lucide="link" class="w-4 h-4"></i> Links Manager
                            </h2>
                        </div>

                        <div class="bg-gray-50 dark:bg-gray-900/50 p-5 rounded-2xl mb-6 border border-gray-100 dark:border-gray-800 shadow-inner">
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-3 mb-3">
                                <div class="md:col-span-4">
                                    <select id="platform-select" class="w-full h-full p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 text-sm appearance-none cursor-pointer">
                                        <option value="custom">üåê Custom Link</option>
                                        <option value="youtube">‚ñ∂Ô∏è YouTube</option>
                                        <option value="instagram">üì∏ Instagram</option>
                                        <option value="linkedin">üíº LinkedIn</option>
                                        <option value="twitter">üê¶ X (Twitter)</option>
                                        <option value="github">üíª GitHub</option>
                                        <option value="tiktok">üéµ TikTok</option>
                                        <option value="portfolio">üé® Portfolio</option>
                                        <option value="email">üìß Email</option>
                                    </select>
                                </div>
                                <div class="md:col-span-8">
                                    <input type="text" id="link-title" placeholder="Link Title (e.g. My Website)" class="w-full p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <input type="text" id="link-url" placeholder="https://..." class="flex-1 p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 text-sm font-mono">
                                <button id="add-link-btn" class="bg-black dark:bg-white text-white dark:text-black px-6 rounded-xl font-bold hover:opacity-80 transition-all shadow-lg text-sm">
                                    Add
                                </button>
                            </div>
                        </div>

                        <div id="links-container" class="space-y-3 min-h-[20px]">
                            <p id="empty-state" class="text-center text-gray-400 text-sm py-4 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-xl">No links added yet.</p>
                        </div>
                    </div>

                    <div class="glass-panel p-6 rounded-3xl animate-fade-in" style="animation-delay: 0.3s;">
                        <h2 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-5 flex items-center gap-2">
                            <i data-lucide="palette" class="w-4 h-4"></i> Design & Style
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-semibold mb-2 ml-1 text-gray-600 dark:text-gray-400">Theme</label>
                                <div class="relative">
                                    <select id="bg-style" class="w-full p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 text-sm appearance-none">
                                        <option value="flat">Clean Flat</option>
                                        <option value="gradient-blue">Ocean Gradient</option>
                                        <option value="gradient-purple">Nebula Gradient</option>
                                        <option value="gradient-sunset">Sunset Gradient</option>
                                        <option value="dark">Midnight Dark</option>
                                        <option value="mesh">Abstract Mesh</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-3 top-3.5 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-semibold mb-2 ml-1 text-gray-600 dark:text-gray-400">Card Style</label>
                                <div class="relative">
                                    <select id="card-style" class="w-full p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 text-sm appearance-none">
                                        <option value="solid">Solid Fill</option>
                                        <option value="glass">Glass / Blur</option>
                                        <option value="outline">Outline Only</option>
                                        <option value="soft">Soft Shadow</option>
                                        <option value="hard">Hard Shadow</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-3 top-3.5 w-4 h-4 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>

                            <div class="md:col-span-2 grid grid-cols-2 gap-4">
                                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700">
                                    <input type="color" id="accent-color-picker" value="#2563eb">
                                    <div class="flex flex-col">
                                        <span class="text-xs font-bold uppercase text-gray-500">Accent</span>
                                        <span class="text-[10px] text-gray-400">Buttons & Links</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700">
                                    <input type="color" id="text-color-picker" value="#ffffff">
                                    <div class="flex flex-col">
                                        <span class="text-xs font-bold uppercase text-gray-500">Text</span>
                                        <span class="text-[10px] text-gray-400">Button Text Color</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel p-6 rounded-3xl animate-fade-in" style="animation-delay: 0.4s;">
                         <h2 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-5 flex items-center gap-2">
                            <i data-lucide="search" class="w-4 h-4"></i> SEO & Meta
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <input type="text" id="seo-title" placeholder="Browser Tab Title" class="w-full p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none text-sm focus:ring-2 focus:ring-blue-500">
                             <input type="text" id="seo-desc" placeholder="Meta Description" class="w-full p-3 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 outline-none text-sm focus:ring-2 focus:ring-blue-500">
                             <div class="flex items-center gap-2 md:col-span-2 p-1">
                                <input type="checkbox" id="verified-badge" class="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <label for="verified-badge" class="text-sm font-medium text-gray-700 dark:text-gray-300">Show Blue Verified Badge</label>
                             </div>
                        </div>
                    </div>

                    <button id="export-btn-mobile" class="md:hidden w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-xl active:scale-95 transition-transform">
                        Download Website
                    </button>
                    
                    <footer class="text-center text-xs text-gray-400 pb-10">
                        ¬© 2025 Accurex Studio ¬∑ Built with V 1.0 Builder
                    </footer>
                </div>

                <div class="lg:col-span-5 sticky top-28 h-[800px]">
                    <div class="relative mx-auto w-[360px] h-[720px] bg-gray-900 dark:bg-[#121212] rounded-[55px] shadow-2xl border-[10px] border-gray-900 dark:border-[#1e1e1e] ring-1 ring-white/10 z-10">
                        
                        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-black rounded-b-3xl z-30 flex items-center justify-center">
                            <div class="w-20 h-4 bg-black rounded-full flex items-center justify-end px-2 gap-1.5">
                                <div class="w-1.5 h-1.5 rounded-full bg-green-500/80"></div>
                                <div class="w-1.5 h-1.5 rounded-full bg-orange-500/80"></div>
                            </div>
                        </div>

                        <div class="absolute top-28 -left-[12px] w-[3px] h-12 bg-gray-700 rounded-l-md"></div>
                        <div class="absolute top-44 -left-[12px] w-[3px] h-16 bg-gray-700 rounded-l-md"></div>
                        <div class="absolute top-32 -right-[12px] w-[3px] h-24 bg-gray-700 rounded-r-md"></div>

                        <div id="preview-screen" class="absolute inset-0 rounded-[45px] overflow-hidden bg-white z-0 transition-all duration-500 flex flex-col">
                            <div id="preview-content" class="preview-scroll flex-1 overflow-y-auto p-6 pt-12 pb-20 text-center no-scrollbar">
                                </div>
                        </div>
                        
                        <div class="absolute inset-0 rounded-[55px] pointer-events-none shadow-[inset_0_0_20px_rgba(255,255,255,0.05)] z-40"></div>
                    </div>
                    
                    <p class="text-center text-xs font-bold text-gray-400 mt-8 tracking-widest uppercase">Live Preview</p>
                </div>

            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- LENIS SMOOTH SCROLL ---
            const lenis = new Lenis({
                duration: 1.2,
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                smooth: true,
            });
            function raf(time) {
                lenis.raf(time);
                requestAnimationFrame(raf);
            }
            requestAnimationFrame(raf);

            // --- STATE MANAGEMENT ---
            const state = {
                logo: '',
                profile: { name: '', bio: '', image: '', verified: false },
                links: [],
                seo: { title: 'My Links', desc: 'Welcome to my personalized page.' },
                style: {
                    bg: 'flat',
                    card: 'solid',
                    accentColor: '#2563eb',
                    textColor: '#ffffff'
                }
            };

            // --- DOM ELEMENTS ---
            const els = {
                logoUpload: document.getElementById('logo-upload'),
                logoPreview: document.getElementById('logo-img-preview'),
                logoBox: document.getElementById('logo-preview-box'),
                removeLogoBtn: document.getElementById('remove-logo-btn'),

                profileUpload: document.getElementById('profile-upload'),
                profilePreview: document.getElementById('profile-img-preview'),
                nameInput: document.getElementById('name-input'),
                bioInput: document.getElementById('bio-input'),
                verifiedCheck: document.getElementById('verified-badge'),
                
                platformSelect: document.getElementById('platform-select'),
                linkTitle: document.getElementById('link-title'),
                linkUrl: document.getElementById('link-url'),
                addLinkBtn: document.getElementById('add-link-btn'),
                linksContainer: document.getElementById('links-container'),
                emptyState: document.getElementById('empty-state'),
                
                bgSelect: document.getElementById('bg-style'),
                cardSelect: document.getElementById('card-style'),
                accentPicker: document.getElementById('accent-color-picker'),
                textPicker: document.getElementById('text-color-picker'),
                
                seoTitle: document.getElementById('seo-title'),
                seoDesc: document.getElementById('seo-desc'),
                
                screen: document.getElementById('preview-screen'),
                content: document.getElementById('preview-content'),
                
                exportBtns: [document.getElementById('export-btn'), document.getElementById('export-btn-mobile')],
                themeToggle: document.getElementById('theme-toggle')
            };

            // --- PLATFORM DATA ---
            const platforms = {
                custom: { label: 'Custom Link', icon: 'link' },
                youtube: { label: 'YouTube', icon: 'youtube', placeholder: 'https://youtube.com/@...' },
                instagram: { label: 'Instagram', icon: 'instagram', placeholder: 'https://instagram.com/...' },
                linkedin: { label: 'LinkedIn', icon: 'linkedin', placeholder: 'https://linkedin.com/in/...' },
                twitter: { label: 'X (Twitter)', icon: 'twitter', placeholder: 'https://x.com/...' },
                github: { label: 'GitHub', icon: 'github', placeholder: 'https://github.com/...' },
                tiktok: { label: 'TikTok', icon: 'music-2', placeholder: 'https://tiktok.com/@...' },
                portfolio: { label: 'Portfolio', icon: 'briefcase', placeholder: 'https://myportfolio.com' },
                email: { label: 'Email', icon: 'mail', placeholder: 'mailto:your@email.com' },
            };

            // --- HELPER: Read Image ---
            const readImage = (file, callback) => {
                const reader = new FileReader();
                reader.onload = (e) => callback(e.target.result);
                reader.readAsDataURL(file);
            };

            // --- EVENT LISTENERS FOR LIVE UPDATES ---
            
            // 1. Profile & Logo
            els.profileUpload.addEventListener('change', (e) => {
                if (e.target.files[0]) readImage(e.target.files[0], (base64) => {
                    state.profile.image = base64;
                    els.profilePreview.src = base64;
                    els.profilePreview.classList.remove('hidden');
                    renderPreview();
                });
            });

            els.logoUpload.addEventListener('change', (e) => {
                if (e.target.files[0]) readImage(e.target.files[0], (base64) => {
                    state.logo = base64;
                    els.logoPreview.src = base64;
                    els.logoPreview.classList.remove('hidden');
                    els.removeLogoBtn.classList.remove('hidden');
                    renderPreview();
                });
            });

            els.removeLogoBtn.addEventListener('click', () => {
                state.logo = '';
                els.logoPreview.classList.add('hidden');
                els.removeLogoBtn.classList.add('hidden');
                els.logoUpload.value = '';
                renderPreview();
            });

            // 2. Text Inputs (Reactivity Fix)
            [els.nameInput, els.bioInput, els.seoTitle, els.seoDesc].forEach(el => {
                el.addEventListener('input', (e) => {
                    if(e.target === els.nameInput) state.profile.name = e.target.value;
                    if(e.target === els.bioInput) state.profile.bio = e.target.value;
                    if(e.target === els.seoTitle) state.seo.title = e.target.value;
                    if(e.target === els.seoDesc) state.seo.desc = e.target.value;
                    renderPreview();
                });
            });

            els.verifiedCheck.addEventListener('change', (e) => {
                state.profile.verified = e.target.checked;
                renderPreview();
            });

            // 3. Styles
            [els.bgSelect, els.cardSelect].forEach(el => {
                el.addEventListener('change', (e) => {
                    if(e.target === els.bgSelect) state.style.bg = e.target.value;
                    if(e.target === els.cardSelect) state.style.card = e.target.value;
                    renderPreview();
                });
            });

            [els.accentPicker, els.textPicker].forEach(el => {
                el.addEventListener('input', (e) => {
                    if(e.target === els.accentPicker) state.style.accentColor = e.target.value;
                    if(e.target === els.textPicker) state.style.textColor = e.target.value;
                    renderPreview();
                });
            });

            // --- LINK MANAGEMENT ---
            els.platformSelect.addEventListener('change', (e) => {
                const p = platforms[e.target.value];
                els.linkTitle.value = p.label;
                els.linkUrl.placeholder = p.placeholder || 'https://...';
            });

            els.addLinkBtn.addEventListener('click', () => {
                const title = els.linkTitle.value.trim();
                const url = els.linkUrl.value.trim();
                const type = els.platformSelect.value;
                if (title && url) {
                    state.links.push({ id: Date.now(), title, url, type });
                    els.linkTitle.value = '';
                    els.linkUrl.value = '';
                    renderControls();
                    renderPreview();
                }
            });

            // --- RENDER FUNCTIONS ---
            function renderControls() {
                els.linksContainer.innerHTML = '';
                if (state.links.length === 0) {
                    els.linksContainer.appendChild(els.emptyState);
                    els.emptyState.style.display = 'block';
                } else {
                    els.emptyState.style.display = 'none';
                    state.links.forEach((link, index) => {
                        const div = document.createElement('div');
                        div.className = 'group flex items-center gap-3 bg-white dark:bg-gray-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm animate-fade-in';
                        div.dataset.id = link.id;
                        const iconName = platforms[link.type]?.icon || 'link';
                        
                        div.innerHTML = `
                            <div class="handle cursor-grab p-1 text-gray-400 hover:text-blue-500"><i data-lucide="grip-vertical" class="w-5 h-5"></i></div>
                            <div class="flex-1 min-w-0 grid gap-1">
                                <div class="flex items-center gap-2 border-b border-transparent focus-within:border-blue-500 transition-colors">
                                    <i data-lucide="${iconName}" class="w-3.5 h-3.5 text-gray-500"></i>
                                    <input type="text" class="edit-title bg-transparent text-sm font-bold w-full outline-none text-gray-800 dark:text-gray-200" value="${link.title}">
                                </div>
                                <input type="text" class="edit-url bg-transparent text-[10px] text-gray-400 w-full outline-none font-mono" value="${link.url}">
                            </div>
                            <button class="delete-btn p-2 hover:bg-red-50 dark:hover:bg-red-900/30 text-gray-400 hover:text-red-500 rounded-lg transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        `;
                        els.linksContainer.appendChild(div);

                        div.querySelector('.edit-title').addEventListener('input', (e) => { state.links[index].title = e.target.value; renderPreview(); });
                        div.querySelector('.edit-url').addEventListener('input', (e) => { state.links[index].url = e.target.value; renderPreview(); });
                        div.querySelector('.delete-btn').addEventListener('click', () => { state.links.splice(index, 1); renderControls(); renderPreview(); });
                    });
                    lucide.createIcons();
                }
            }

            function renderPreview() {
                // 1. Background
                let bgClass = '';
                switch(state.style.bg) {
                    case 'flat': bgClass = 'bg-[#f8fafc]'; break;
                    case 'dark': bgClass = 'bg-[#0f172a] text-white'; break;
                    case 'gradient-blue': bgClass = 'bg-gradient-to-br from-cyan-50 to-blue-100'; break;
                    case 'gradient-purple': bgClass = 'bg-gradient-to-br from-indigo-50 to-purple-100'; break;
                    case 'gradient-sunset': bgClass = 'bg-gradient-to-br from-orange-50 to-rose-100'; break;
                    case 'mesh': bgClass = 'bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-indigo-200 via-red-200 to-yellow-100'; break;
                }
                els.screen.className = `absolute inset-0 rounded-[45px] overflow-hidden transition-all duration-500 z-0 flex flex-col ${bgClass}`;

                // 2. Card Style
                let cardStyle = '';
                const isDarkBg = state.style.bg === 'dark';
                
                if (state.style.card === 'solid') {
                    cardStyle = `background-color: ${state.style.accentColor}; color: ${state.style.textColor};`;
                } else if (state.style.card === 'outline') {
                    cardStyle = `border: 2px solid ${state.style.accentColor}; color: ${state.style.accentColor}; background: transparent;`;
                } else if (state.style.card === 'glass') {
                    cardStyle = `background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); color: ${isDarkBg ? 'white' : 'black'};`;
                } else if (state.style.card === 'soft') {
                     cardStyle = `background-color: white; color: black; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);`;
                } else if (state.style.card === 'hard') {
                     cardStyle = `background-color: white; color: black; border: 2px solid black; box-shadow: 4px 4px 0px black;`;
                }

                // 3. Components
                const imgHTML = state.profile.image 
                    ? `<img src="${state.profile.image}" class="w-full h-full object-cover">` 
                    : `<div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 text-2xl font-bold">${state.profile.name.charAt(0) || 'U'}</div>`;

                const logoHTML = state.logo
                    ? `<img src="${state.logo}" class="h-12 mb-6 object-contain mx-auto animate-fade-in">`
                    : '';

                const mainTextColor = isDarkBg ? 'text-white' : 'text-gray-900';
                const subTextColor = isDarkBg ? 'text-gray-400' : 'text-gray-500';

                // 4. Inject HTML
                els.content.innerHTML = `
                    <div class="animate-fade-in flex flex-col items-center w-full">
                        ${logoHTML}
                        <div class="w-24 h-24 rounded-full overflow-hidden ring-4 ring-white/40 shadow-xl mb-4 mx-auto bg-gray-50">
                            ${imgHTML}
                        </div>
                        <div class="flex items-center gap-1 mb-2">
                            <h1 class="text-xl font-bold ${mainTextColor} text-center leading-tight">
                                ${state.profile.name || '@Username'}
                            </h1>
                            ${state.profile.verified ? `<i data-lucide="badge-check" class="w-5 h-5 text-blue-500 fill-blue-500/10"></i>` : ''}
                        </div>
                        <p class="text-sm ${subTextColor} mb-8 max-w-[280px] mx-auto leading-relaxed whitespace-pre-wrap">${state.profile.bio || 'Add a bio...'}</p>
                        
                        <div class="w-full space-y-3 px-2">
                            ${state.links.map(link => `
                                <a href="${link.url}" target="_blank" class="block w-full p-4 rounded-xl transition-transform active:scale-95 flex items-center justify-center gap-2 font-bold shadow-sm" style="${cardStyle}">
                                    <i data-lucide="${platforms[link.type]?.icon || 'link'}" class="w-5 h-5"></i>
                                    ${link.title}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                // CRITICAL FIX: Re-initialize icons inside preview
                lucide.createIcons();
            }

            // --- SORTABLE ---
            new Sortable(els.linksContainer, {
                handle: '.handle',
                animation: 150,
                ghostClass: 'ghost-class',
                onEnd: () => {
                    const newOrder = Array.from(els.linksContainer.children).map(child => Number(child.dataset.id));
                    state.links.sort((a,b) => newOrder.indexOf(a.id) - newOrder.indexOf(b.id));
                    renderPreview();
                }
            });

            // --- THEME ---
            const toggleTheme = () => {
                const isDark = document.documentElement.classList.toggle('dark');
                els.themeToggle.innerHTML = isDark ? '<i data-lucide="sun" class="w-5 h-5"></i>' : '<i data-lucide="moon" class="w-5 h-5"></i>';
                lucide.createIcons();
            };
            els.themeToggle.addEventListener('click', toggleTheme);

            // --- EXPORT ---
            const exportHTML = () => {
                let outputBgClass = '';
                switch(state.style.bg) {
                    case 'flat': outputBgClass = 'bg-slate-50 text-slate-900'; break;
                    case 'dark': outputBgClass = 'bg-slate-900 text-white'; break;
                    case 'gradient-blue': outputBgClass = 'bg-gradient-to-br from-cyan-50 to-blue-100 text-slate-900'; break;
                    case 'gradient-purple': outputBgClass = 'bg-gradient-to-br from-indigo-50 to-purple-100 text-slate-900'; break;
                    case 'gradient-sunset': outputBgClass = 'bg-gradient-to-br from-orange-50 to-rose-100 text-slate-900'; break;
                    case 'mesh': outputBgClass = 'bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-indigo-200 via-red-200 to-yellow-100 text-slate-900'; break;
                }

                let cardCss = '';
                if(state.style.card === 'solid') cardCss = `background-color: ${state.style.accentColor}; color: ${state.style.textColor}; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);`;
                else if(state.style.card === 'outline') cardCss = `border: 2px solid ${state.style.accentColor}; color: ${state.style.accentColor}; background: transparent;`;
                else if(state.style.card === 'glass') cardCss = `background: rgba(255,255,255,0.25); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.3); color: inherit;`;
                else if(state.style.card === 'soft') cardCss = `background: white; color: black; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);`;
                else if(state.style.card === 'hard') cardCss = `background: white; color: black; border: 2px solid black; box-shadow: 4px 4px 0px black;`;

                const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${state.seo.title}</title>
    <meta name="description" content="${state.seo.desc}">
    <script src="https://cdn.tailwindcss.com"><\/script>
    <script src="https://unpkg.com/lucide@latest"><\/script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .link-card {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            width: 100%; padding: 16px; margin-bottom: 12px; border-radius: 12px;
            font-weight: 700; text-decoration: none; transition: transform 0.2s;
            ${cardCss}
        }
        .link-card:active { transform: scale(0.98); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-12 px-4 ${outputBgClass}">
    <div class="w-full max-w-md animate-[fadeIn_0.5s_ease-out]">
        <div class="flex flex-col items-center text-center">
            ${state.logo ? `<img src="${state.logo}" class="h-12 mb-6 object-contain">` : ''}
            <div class="w-24 h-24 rounded-full overflow-hidden shadow-xl mb-4 ring-4 ring-white/30 bg-gray-100">
                ${state.profile.image ? `<img src="${state.profile.image}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center text-2xl font-bold text-gray-400 bg-gray-200">${state.profile.name.charAt(0)}</div>`}
            </div>
            <h1 class="text-2xl font-bold flex items-center justify-center gap-1 mb-2 leading-tight">
                ${state.profile.name}
                ${state.profile.verified ? `<i data-lucide="badge-check" class="w-5 h-5 text-blue-500 fill-blue-500/10"></i>` : ''}
            </h1>
            <p class="text-sm opacity-80 mb-8 max-w-xs leading-relaxed whitespace-pre-wrap">${state.profile.bio}</p>
            <div class="w-full">
                ${state.links.map(link => `
                    <a href="${link.url}" target="_blank" class="link-card">
                        <i data-lucide="${platforms[link.type]?.icon || 'link'}" width="20"></i>
                        ${link.title}
                    </a>
                `).join('')}
            </div>
            <div class="mt-12 text-xs opacity-50">Created with Accurex Studio</div>
        </div>
    </div>
    <script>lucide.createIcons();<\/script>
</body>
</html>`;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'my-links.html';
                a.click();
            };

            els.exportBtns.forEach(btn => btn.addEventListener('click', exportHTML));

            // Initial Render
            lucide.createIcons();
            renderPreview();
        });
    </script>
</body>
</html>